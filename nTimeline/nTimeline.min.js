/**
 * @PluginName	nTimeline.js
 * @Requires	jQuery, jQuery-ui, TweenMax( GSAP )
 * @Author		nonoll ( http://usefl.co.kr - hyunkwan Roh )
 * @Version		0.0.1
 * @Date		2015.07.20
 * @description
 * 	TweenMax 의 Timeline 애니메이션을 위한 Timeline 디버깅 화면 구성
 * 	Button : beginning, rewind, play & pause, stop, forward, end, autorun, repeat, align( 'top' / 'bottom' )
 * 	Options : {
 * 	 			timeline 		GSAP - Timeline
 * 	 			autorun 		Timeline Animate Autorun Flag
 * 	 			repeat 			Timeline Animate Repeat Flag
 * 	 			debug 			nTimeline.js Debug log Flag
 * 	 			modulePath 		nTimeline.js Module Path
 * 	 			align 			nTimeline.js Debbuger Display Align ( 'top', 'bottom' )
 * 	}
 */
!function(i,e){"use strict";"undefined"==typeof e.nTimeline&&(e.nTimeline={}),e.nTimeline=function(){var n="nTimeline.js",t="0.0.1",o={value:0};return{init:function(e){return this.options={timeline:null,autorun:!0,repeat:!0,debug:!0,modulePath:"./nTimeline/",align:"top"},this.container=null,this.btnAutorun=null,this.btnRepeat=null,this.btnAlign=null,this.slider=null,this.duration_cur=null,this.duration_total=null,i.extend(!0,this.options,e),this.copyLog(),this.log("window.nTimeline > init this.options : ",this.options),this.options.timeline?0===this.options.timeline._totalDuration?void alert("[ "+n+" ]\nTimeline Duration이 0초입니다."):(this.plugins.init(),this):void alert("[ "+n+" ]\nTimeline 객체를 설정하세요.")},copyLog:function(){if(e.console){var i="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #fff; font-size: 20px; padding: 15px 20px; background: #444; border-radius: 4px; line-height: 100px; text-shadow: 0 1px #000;",o="%c"+n+" - V "+t;console.log(o,i)}},templetLog:function(){if(e.console){var i="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #fff; font-size: 20px; padding: 15px 20px; background: #ff0000; border-radius: 4px; line-height: 100px; text-shadow: 0 1px #000;",n="%cnTimeline.html 로드 실패 - 기본 템플릿 반영";console.warn(n,i)}},templetMarkup:function(){var i="";return i+='<div id="nTimeline_debugger" style="{{ALIGN}}">',i+='	<div data-role="wrap" class="ui-widget-header">',i+='		<div data-role="timeline"></div>',i+='		<div data-role="controller">',i+='			<button data-role="beginning">go to beginning</button>',i+='			<button data-role="rewind">rewind</button>',i+='			<button data-role="play">{{PLAY_MODE}}</button>',i+='			<button data-role="stop">stop</button>',i+='			<button data-role="forward">fast forward</button>',i+='			<button data-role="end">go to end</button>',i+='			<input data-role="autorun" type="checkbox" id="nTimeline_autorun"><label for="nTimeline_autorun">autorun</label>',i+='			<input data-role="repeat" type="checkbox" id="nTimeline_repeat"><label for="nTimeline_repeat">repeat</label>',i+='			<input data-role="align" type="checkbox" id="nTimeline_align"><label for="nTimeline_align">{{BTN_ALIGN}}</label>',i+="		</div>",i+='		<div data-role="duration">',i+="			<span>&nbsp;Duration&nbsp;:&nbsp;&nbsp;</span>",i+='			<span data-role="duration_cur"></span>',i+='			<span data-role="duration_total" style="color: #888;"></span>',i+="		</div>",i+="	</div>",i+='	<div data-role="display" class="ui-widget-header">',i+='		<span data-role="name">{{INFO}}</span>',i+='		<button data-role="btn">close</button>',i+="	</div>",i+="</div>"},getModulePath:function(){return this.options.modulePath},getVersion:function(){return t},isAutoRun:function(){return this.btnAutorun.is(":checked")},isRepeat:function(){return this.btnRepeat.is(":checked")},isPlay:function(){return this.options.timeline._active},comma:function(i){return(""+i).split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")},currencyFormat:function(i,e){return e=e||!1,e?"￦"+this.comma(i,3):this.comma(i,3)},addZero:function(i){return parseInt(i)<10?"0"+i:""+i},timeToString:function(i){var e,n,t,o=i,a=Math.floor(o/60),l=Math.floor(o/3600);return e=this.addZero(o>=60?o%60:o),n=this.addZero(a>=60?a%60:a),t=this.addZero(l),t=this.currencyFormat(t),{hour:t,minute:n,second:e,ms:n+":"+e,hms:t+":"+n+":"+e}},ready:function(){var e=this;switch(this.log("window.nTimeline > ready"),this.options.align){case"bottom":i("body").append("<div id='nTimeline_area'>");break;case"top":default:i("body").prepend("<div id='nTimeline_area'>")}i.ajax({url:e.getModulePath()+"nTimeline.html",type:"GET",dataType:"html"}).done(function(i){e.log("window.nTimeline > ready ajax done",i),e.display(i)}).fail(function(i){e.log("window.nTimeline > ready ajax Error",i),e.templetLog(),e.display(e.templetMarkup())})},display:function(e){switch(this.log("window.nTimeline > display html",e),e=e.replace("{{INFO}}","[ nTimeline DEBUGER - V "+this.getVersion()+" ]"),e=this.options.autorun?e.replace("{{PLAY_MODE}}","pause"):e.replace("{{PLAY_MODE}}","play"),this.options.align){case"bottom":e=e.replace("{{ALIGN}}","bottom: 0px"),e=e.replace("{{BTN_ALIGN}}","top");break;case"top":default:e=e.replace("{{ALIGN}}","top: 0px"),e=e.replace("{{BTN_ALIGN}}","bottom")}i("body").append(e),this.setTimeline(),this.setUiBtns(),this.options.autorun?this.options.timeline.play():setTimeout(function(){this.options.timeline.pause(),this.options.timeline.progress(0)},10)},setTimeline:function(){var e=this;this.log("window.nTimeline > setTimeline"),this.container=i("div#nTimeline_debugger"),this.duration_cur=this.container.find('div[data-role="duration"] > span[data-role="duration_cur"]'),this.duration_total=this.container.find('div[data-role="duration"] > span[data-role="duration_total"]'),this.slider=i('div[data-role="timeline"]').slider({range:"min",min:0,max:100,value:0,step:.1,start:function(){e.render(),e.options.autorun||e.options.timeline.pause()},slide:function(i,n){e.options.timeline.progress(n.value/100)},stop:function(){e.options.autorun&&e.options.timeline.play(),e.render()}}),i('div[data-role="timeline"] span').mouseleave(function(e){i(this).blur()}),this.options.timeline.eventCallback("onUpdate",function(){e.duration_cur.text(e.timeToString(e.options.timeline._time.toFixed(0)).ms),e.duration_total.text(" / "+e.timeToString(e.options.timeline._totalDuration.toFixed(1)).ms),o.value=100*e.options.timeline.progress(),e.slider.slider(o)}),this.options.timeline.eventCallback("onComplete",function(){e.log("timeline onComplete"),e.options.repeat&&(e.options.timeline.progress(0),e.options.timeline.play(),e.log("timeline onComplete REPEAT")),e.render()}),i('div[data-role="timeline"]').find("div.ui-slider-range").css({background:"#ff6600"})},setUiBtns:function(){var e=this;this.log("window.nTimeline > setUiBtns"),this.btnAutorun=this.container.find('div[data-role="controller"] input[data-role="autorun"]'),this.btnAutorun.button().click(function(n){i(this).blur(),e.options.autorun=i(this).is(":checked"),e.options.autorun&&(e.options.timeline.play(),e.render()),e.log("window.nTimeline > setUiBtns btnAutorun ",e.options.autorun)}),this.options.autorun&&(this.btnAutorun.prop("checked",!0),this.btnAutorun.button("refresh")),this.btnRepeat=this.container.find('div[data-role="controller"] input[data-role="repeat"]'),this.btnRepeat.button().click(function(n){i(this).blur(),e.options.repeat=i(this).is(":checked"),e.log("window.nTimeline > setUiBtns btnRepeat ",e.options.autorun)}),this.options.repeat&&(this.btnRepeat.prop("checked",!0),this.btnRepeat.button("refresh")),i.each(this.container.find('div[data-role="controller"] button'),function(n,t){var o=i(this).data("role"),a={text:!1,icons:{primary:""}};switch(o){case"beginning":a.icons.primary="ui-icon-seek-start";break;case"rewind":a.icons.primary="ui-icon-seek-prev";break;case"play":e.options.autorun?a.icons.primary="ui-icon-pause":a.icons.primary="ui-icon-play";break;case"stop":a.icons.primary="ui-icon-stop";break;case"forward":a.icons.primary="ui-icon-seek-next";break;case"end":a.icons.primary="ui-icon-seek-end";break;case"align":e.btnAlign=i(this)}i(this).button(a).click(function(n){var t=i(this).data("role"),o=0,a={};switch(t){case"beginning":e.options.timeline.progress(0);break;case"rewind":o=e.options.timeline.progress()-.05<=0?0:e.options.timeline.progress()-.05,e.options.timeline.progress(o);break;case"forward":o=e.options.timeline.progress()+.05>=1?1:e.options.timeline.progress()+.05,e.options.timeline.progress(o);break;case"end":e.options.timeline.progress(1);break;case"play":"play"===i(this).text()?(a={label:"pause",icons:{primary:"ui-icon-pause"}},1===e.options.timeline.progress()&&e.options.timeline.progress(0),e.options.timeline.play()):(a={label:"play",icons:{primary:"ui-icon-play"}},e.options.timeline.pause()),i(this).button(a);break;case"stop":e.options.timeline.pause(),e.options.timeline.progress(0),a={label:"play",icons:{primary:"ui-icon-play"}},e.container.find('div[data-role="controller"] button[data-role="play"]').button(a);break;case"align":a="bottom"===i(this).text()?{label:"top"}:{label:"bottom"},i(this).button(a),e.changeAlign(a.label)}i(this).blur()})}),i('div[data-role="display"] button').button({text:!1,icons:{primary:"top"===e.options.align?"ui-icon-circle-triangle-n":"ui-icon-circle-triangle-s"}}).click(function(n){var t;"close"===i(this).text()?(t={label:"open",icons:{primary:"top"===e.options.align?"ui-icon-circle-triangle-s":"ui-icon-circle-triangle-n"}},i("div#nTimeline_area").animate({height:i(this).height()},400),"bottom"===e.options.align&&i('div#nTimeline_debugger > div[data-role="wrap"]').animate({"margin-top":i('div#nTimeline_debugger > div[data-role="wrap"]').height()},400,function(){i(this).hide(),i('div[data-role="display"]').css({"margin-top":84})})):(t={label:"close",icons:{primary:"top"===e.options.align?"ui-icon-circle-triangle-n":"ui-icon-circle-triangle-s"}},i("div#nTimeline_area").animate({height:115},400),"bottom"===e.options.align&&(i('div#nTimeline_debugger > div[data-role="wrap"]').show(),i('div#nTimeline_debugger > div[data-role="wrap"]').animate({"margin-top":0},400,function(){}),i(this).parent().css({"margin-top":0}))),"bottom"!==e.options.align&&i('div#nTimeline_debugger > div[data-role="wrap"]').slideToggle(),i(this).button(t),i(this).blur()})},render:function(){var i=this,e={};this.isPlay()?(e={label:"pause",icons:{primary:"ui-icon-pause"}},i.container.find('div[data-role="controller"] button[data-role="play"]').button(e)):(e={label:"play",icons:{primary:"ui-icon-play"}},i.container.find('div[data-role="controller"] button[data-role="play"]').button(e))},changeAlign:function(e){switch(i("div#nTimeline_area").length&&i("div#nTimeline_area").remove(),e){case"bottom":i("body").prepend("<div id='nTimeline_area'>"),this.container.css({top:"0px",bottom:""}),this.options.align="top";break;case"top":default:i("body").append("<div id='nTimeline_area'>"),this.container.css({top:"",bottom:"0px"}),this.options.align="bottom"}i('div[data-role="display"] button').button({text:!1,icons:{primary:"top"===this.options.align?"ui-icon-circle-triangle-n":"ui-icon-circle-triangle-s"}}),this.btnAlign.blur()},log:function(){e.console&&this.options.debug&&console.log(Array.prototype.slice.call(arguments))}}}(),e.nTimeline.plugins=function(){var n=0,t=0;return{init:function(){e.nTimeline.log("window.nTimeline.plugins > init"),"undefined"==typeof i.fn.slider?(e.nTimeline.log("window.nTimeline.plugins > init require jquery ui"),this.loadPlugin("jquery-ui"),this.loadPlugin("jquery-ui-css")):i("link[href='"+e.nTimeline.getModulePath()+"jquery-ui.min.css']").prop("sheet")||this.loadPlugin("jquery-ui-css"),this.loadPlugin("nTimeline"),this.loadedPlugin()},loadPlugin:function(i){var t=this;switch(e.nTimeline.log("window.nTimeline.plugins > loadPlugin moduel",i),i){case"jquery-ui":n+=1,this.loadJS([e.nTimeline.getModulePath()+"jquery-ui.min.js"],function(i){e.nTimeline.log("window.nTimeline.plugins > loadPlugin moduel jquery-ui.min.js",i),t.loadedPlugin()});break;case"jquery-ui-css":n+=1,this.loadCSS([e.nTimeline.getModulePath()+"jquery-ui.min.css"],function(i){e.nTimeline.log("window.nTimeline.plugins > loadPlugin moduel jquery-ui.min.css",i),t.loadedPlugin()});break;case"TweenMax":n+=1,this.loadJS([e.nTimeline.getModulePath()+"TweenMax.min.js"],function(i){e.nTimeline.log("window.nTimeline.plugins > loadPlugin moduel TweenMax.min.js",i),t.loadedPlugin()});break;case"nTimeline":n+=1,this.loadCSS([e.nTimeline.getModulePath()+"nTimeline.css"],function(i){e.nTimeline.log("window.nTimeline.plugins > loadPlugin moduel nTimeline.css",i),t.loadedPlugin()})}},loadedPlugin:function(){t++,e.nTimeline.log("window.nTimeline.plugins > loadedPlugin PLUGIN_LOADED",t),t>n&&(e.nTimeline.log("window.nTimeline.plugins > loadedPlugin ALL LOAD COMPLETE"),e.nTimeline.ready())},loadCSS:function(e,n,t){"undefined"==typeof t&&(t=!1),i.each(e,function(e,o){t&&(o+="?nocache="+(new Date).getTime()),i.get(o,function(e){i("<link>",{rel:"stylesheet",type:"text/css",href:o}).appendTo("head")}).done(function(i){n&&n({url:o,statusText:"done"})}).fail(function(e){var t={url:o};i.extend(!0,t,e),n&&n(t)})})},loadJS:function(e,n,t){"undefined"==typeof t&&(t=!1),i.each(e,function(e,o){t&&(o+="?nocache="+(new Date).getTime()),i.get(o,function(e){i("<script>",{type:"text/javascript",src:o}).appendTo("head")}).done(function(i){n&&n({url:o,statusText:"done"})}).fail(function(e){var t={url:o};i.extend(!0,t,e),n&&n(t)})})}}}()}(jQuery,window);